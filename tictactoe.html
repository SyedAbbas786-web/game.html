<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tic-Tac-Toe | Ultimate Edition</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Reset & Base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Light Theme */
            --light-primary: #4361ee;
            --light-secondary: #3a0ca3;
            --light-accent: #f72585;
            --light-success: #4cc9f0;
            --light-warning: #f8961e;
            --light-bg: #f8f9fa;
            --light-card: #ffffff;
            --light-text: #212529;
            --light-text-secondary: #6c757d;
            --light-border: #dee2e6;
            --light-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
            
            /* Dark Theme */
            --dark-primary: #4361ee;
            --dark-secondary: #3a0ca3;
            --dark-accent: #f72585;
            --dark-success: #4cc9f0;
            --dark-warning: #f8961e;
            --dark-bg: #121212;
            --dark-card: #1e1e1e;
            --dark-text: #ffffff;
            --dark-text-secondary: #adb5bd;
            --dark-border: #2d2d2d;
            --dark-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            transition: all 0.3s ease;
        }

        body.light-theme {
            --primary: var(--light-primary);
            --secondary: var(--light-secondary);
            --accent: var(--light-accent);
            --success: var(--light-success);
            --warning: var(--light-warning);
            --bg: var(--light-bg);
            --card: var(--light-card);
            --text: var(--light-text);
            --text-secondary: var(--light-text-secondary);
            --border: var(--light-border);
            --shadow: var(--light-shadow);
        }

        body.dark-theme {
            --primary: var(--dark-primary);
            --secondary: var(--dark-secondary);
            --accent: var(--dark-accent);
            --success: var(--dark-success);
            --warning: var(--dark-warning);
            --bg: var(--dark-bg);
            --card: var(--dark-card);
            --text: var(--dark-text);
            --text-secondary: var(--dark-text-secondary);
            --border: var(--dark-border);
            --shadow: var(--dark-shadow);
        }

        .container {
            width: 100%;
            max-width: 1200px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 30px;
            width: 100%;
        }

        .title {
            font-size: 3.5rem;
            font-weight: 700;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.1rem;
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto 20px;
        }

        /* Theme Toggle */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .theme-btn {
            background: var(--card);
            border: 2px solid var(--border);
            border-radius: 50px;
            padding: 10px 20px;
            font-size: 1rem;
            font-weight: 600;
            color: var(--text);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: var(--shadow);
        }

        .theme-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        /* Main Container */
        .main-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            min-height: 70vh;
        }

        /* Menu Section */
        .menu-section {
            background: var(--card);
            border-radius: 20px;
            padding: 40px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            width: 100%;
            max-width: 800px;
            text-align: center;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .menu-title {
            font-size: 2rem;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .menu-card {
            background: var(--bg);
            border-radius: 15px;
            padding: 25px;
            border: 2px solid var(--border);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .menu-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        }

        .menu-card i {
            font-size: 3rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .menu-card h3 {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text);
        }

        .menu-card p {
            font-size: 0.9rem;
            color: var(--text-secondary);
            text-align: center;
        }

        /* Game Section */
        .game-section {
            background: var(--card);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            width: 100%;
            max-width: 800px;
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border);
        }

        .game-info {
            display: flex;
            gap: 20px;
        }

        .player-info {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            background: var(--bg);
            border-radius: 10px;
            border: 2px solid var(--border);
        }

        .player-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            color: white;
        }

        .player-icon.x {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
        }

        .player-icon.o {
            background: linear-gradient(135deg, var(--accent), #b5179e);
        }

        .player-name {
            font-weight: 600;
            color: var(--text);
        }

        .player-score {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .turn-indicator {
            padding: 10px 25px;
            background: var(--primary);
            color: white;
            border-radius: 50px;
            font-weight: 600;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        /* Game Board */
        .game-board-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 40px 0;
        }

        .game-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 15px;
            aspect-ratio: 1;
            max-width: 500px;
            width: 100%;
            margin: 0 auto;
        }

        .cell {
            background: var(--bg);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid var(--border);
            user-select: none;
        }

        .cell:hover:not(.occupied) {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .cell.x {
            color: var(--primary);
        }

        .cell.o {
            color: var(--accent);
        }

        .cell.win {
            animation: winAnimation 1s ease-in-out;
            background: rgba(76, 201, 240, 0.1);
            border-color: var(--success);
        }

        @keyframes winAnimation {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Controls */
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
        }

        .btn-secondary {
            background: var(--text-secondary);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #2a9d8f);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--accent), #b5179e);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        /* Settings Panel */
        .settings-panel {
            background: var(--card);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            width: 100%;
            max-width: 800px;
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .settings-title {
            font-size: 2rem;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .setting-card {
            background: var(--bg);
            border-radius: 15px;
            padding: 25px;
            border: 2px solid var(--border);
        }

        .setting-card h3 {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .option-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .option-btn {
            padding: 15px;
            background: var(--card);
            border: 2px solid var(--border);
            border-radius: 10px;
            color: var(--text);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .option-btn:hover {
            border-color: var(--primary);
            transform: translateX(5px);
        }

        .option-btn.active {
            border-color: var(--primary);
            background: rgba(67, 97, 238, 0.1);
        }

        .slider-container {
            margin-top: 20px;
        }

        .slider-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .slider-label {
            font-weight: 600;
            color: var(--text);
        }

        .slider-value {
            font-weight: 700;
            color: var(--primary);
        }

        .slider {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            background: var(--border);
            border-radius: 4px;
            outline: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            cursor: pointer;
            box-shadow: 0 0 10px rgba(67, 97, 238, 0.5);
        }

        .difficulty-levels {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        /* Overlay */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            animation: fadeIn 0.3s ease;
        }

        .overlay-content {
            background: var(--card);
            border-radius: 20px;
            padding: 50px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
        }

        @keyframes slideUp {
            from { transform: translateY(50px) scale(0.9); opacity: 0; }
            to { transform: translateY(0) scale(1); opacity: 1; }
        }

        .overlay h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .overlay p {
            font-size: 1.2rem;
            margin-bottom: 30px;
            color: var(--text);
        }

        /* Stats Panel */
        .stats-panel {
            background: var(--card);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            width: 100%;
            max-width: 800px;
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--bg);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 2px solid var(--border);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 10px 0;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .history-list {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .history-item {
            background: var(--bg);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            border: 1px solid var(--border);
        }

        .history-item:hover {
            border-color: var(--primary);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .title {
                font-size: 2.5rem;
            }
            
            .game-board {
                max-width: 350px;
            }
            
            .cell {
                font-size: 3rem;
            }
            
            .menu-grid {
                grid-template-columns: 1fr;
            }
            
            .settings-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .title {
                font-size: 2rem;
            }
            
            .game-board {
                max-width: 280px;
            }
            
            .cell {
                font-size: 2.5rem;
            }
            
            .game-header {
                flex-direction: column;
                gap: 20px;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .menu-section, 
            .game-section, 
            .settings-panel,
            .stats-panel {
                padding: 20px;
            }
        }
    </style>
</head>
<body class="dark-theme">
    <div class="container">
        <!-- Theme Toggle -->
        <div class="theme-toggle">
            <button class="theme-btn" id="themeToggle">
                <i class="fas fa-moon"></i> Dark Mode
            </button>
        </div>

        <!-- Header -->
        <header class="header">
            <h1 class="title">Tic-Tac-Toe Ultimate</h1>
            <p class="subtitle">The ultimate Tic-Tac-Toe experience with AI opponents and beautiful themes</p>
        </header>

        <!-- Main Container -->
        <div class="main-container">
            <!-- Main Menu -->
            <section class="menu-section" id="mainMenu">
                <div class="menu-title">
                    <i class="fas fa-gamepad"></i> Main Menu
                </div>
                <div class="menu-grid">
                    <div class="menu-card" id="playVsPlayer">
                        <i class="fas fa-user-friends"></i>
                        <h3>Player vs Player</h3>
                        <p>Play against a friend on the same device</p>
                    </div>
                    <div class="menu-card" id="playVsAI">
                        <i class="fas fa-robot"></i>
                        <h3>Player vs AI</h3>
                        <p>Challenge our intelligent AI opponent</p>
                    </div>
                    <div class="menu-card" id="openSettings">
                        <i class="fas fa-cog"></i>
                        <h3>Settings</h3>
                        <p>Customize game options and difficulty</p>
                    </div>
                    <div class="menu-card" id="openStats">
                        <i class="fas fa-chart-line"></i>
                        <h3>Statistics</h3>
                        <p>View your game stats and history</p>
                    </div>
                </div>
                <div class="controls">
                    <button class="btn btn-secondary" id="howToPlay">
                        <i class="fas fa-question-circle"></i> How to Play
                    </button>
                </div>
            </section>

            <!-- Game Section -->
            <section class="game-section" id="gameSection">
                <div class="game-header">
                    <div class="game-info">
                        <div class="player-info">
                            <div class="player-icon x">
                                <i class="fas fa-times"></i>
                            </div>
                            <div>
                                <div class="player-name" id="playerXName">Player X</div>
                                <div class="player-score" id="playerXScore">Wins: 0</div>
                            </div>
                        </div>
                        <div class="player-info">
                            <div class="player-icon o">
                                <i class="far fa-circle"></i>
                            </div>
                            <div>
                                <div class="player-name" id="playerOName">Player O</div>
                                <div class="player-score" id="playerOScore">Wins: 0</div>
                            </div>
                        </div>
                    </div>
                    <div class="turn-indicator" id="turnIndicator">
                        Player X's Turn
                    </div>
                </div>

                <div class="game-board-container">
                    <div class="game-board" id="gameBoard">
                        <!-- Cells will be generated by JavaScript -->
                    </div>
                </div>

                <div class="controls">
                    <button class="btn btn-primary" id="resetGame">
                        <i class="fas fa-redo"></i> New Game
                    </button>
                    <button class="btn btn-secondary" id="undoMove">
                        <i class="fas fa-undo"></i> Undo
                    </button>
                    <button class="btn btn-success" id="getHint">
                        <i class="fas fa-lightbulb"></i> Hint
                    </button>
                    <button class="btn btn-danger" id="backToMenu">
                        <i class="fas fa-home"></i> Menu
                    </button>
                </div>
            </section>

            <!-- Settings Panel -->
            <section class="settings-panel" id="settingsPanel">
                <div class="settings-title">
                    <i class="fas fa-cog"></i> Game Settings
                </div>
                <div class="settings-grid">
                    <div class="setting-card">
                        <h3><i class="fas fa-gamepad"></i> Game Mode</h3>
                        <div class="option-list">
                            <button class="option-btn active" data-mode="pvp">
                                <i class="fas fa-user-friends"></i> Player vs Player
                            </button>
                            <button class="option-btn" data-mode="pvc">
                                <i class="fas fa-robot"></i> Player vs AI
                            </button>
                        </div>
                    </div>
                    
                    <div class="setting-card">
                        <h3><i class="fas fa-brain"></i> AI Difficulty</h3>
                        <div class="slider-container">
                            <div class="slider-header">
                                <span class="slider-label">Intelligence Level</span>
                                <span class="slider-value" id="aiLevelValue">Medium</span>
                            </div>
                            <input type="range" min="1" max="5" value="3" class="slider" id="aiDifficulty">
                            <div class="difficulty-levels">
                                <span>Easy</span>
                                <span>Medium</span>
                                <span>Hard</span>
                                <span>Expert</span>
                                <span>Master</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="setting-card">
                        <h3><i class="fas fa-palette"></i> Appearance</h3>
                        <div class="option-list">
                            <button class="option-btn active" id="themeDark">
                                <i class="fas fa-moon"></i> Dark Theme
                            </button>
                            <button class="option-btn" id="themeLight">
                                <i class="fas fa-sun"></i> Light Theme
                            </button>
                        </div>
                    </div>
                    
                    <div class="setting-card">
                        <h3><i class="fas fa-music"></i> Sound & Effects</h3>
                        <div class="option-list">
                            <button class="option-btn active" id="soundOn">
                                <i class="fas fa-volume-up"></i> Sound On
                            </button>
                            <button class="option-btn" id="soundOff">
                                <i class="fas fa-volume-mute"></i> Sound Off
                            </button>
                            <button class="option-btn active" id="animationsOn">
                                <i class="fas fa-play-circle"></i> Animations On
                            </button>
                            <button class="option-btn" id="animationsOff">
                                <i class="fas fa-stop-circle"></i> Animations Off
                            </button>
                        </div>
                    </div>
                </div>
                <div class="controls">
                    <button class="btn btn-primary" id="saveSettings">
                        <i class="fas fa-save"></i> Save Settings
                    </button>
                    <button class="btn btn-secondary" id="cancelSettings">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
            </section>

            <!-- Stats Panel -->
            <section class="stats-panel" id="statsPanel">
                <div class="settings-title">
                    <i class="fas fa-chart-line"></i> Game Statistics
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalGames">0</div>
                        <div class="stat-label">Games Played</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="xWins">0</div>
                        <div class="stat-label">X Wins</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="oWins">0</div>
                        <div class="stat-label">O Wins</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="draws">0</div>
                        <div class="stat-label">Draws</div>
                    </div>
                </div>
                <div class="setting-card">
                    <h3><i class="fas fa-history"></i> Recent Games</h3>
                    <div class="history-list" id="historyList">
                        <!-- History will be populated here -->
                    </div>
                </div>
                <div class="controls">
                    <button class="btn btn-danger" id="clearStats">
                        <i class="fas fa-trash"></i> Clear Stats
                    </button>
                    <button class="btn btn-secondary" id="backFromStats">
                        <i class="fas fa-arrow-left"></i> Back
                    </button>
                </div>
            </section>
        </div>
    </div>

    <!-- Game Over Overlay -->
    <div class="overlay" id="gameOverlay">
        <div class="overlay-content">
            <h2 id="overlayTitle">Game Over</h2>
            <p id="overlayMessage">Player X wins!</p>
            <div class="controls">
                <button class="btn btn-primary" id="playAgain">
                    <i class="fas fa-play"></i> Play Again
                </button>
                <button class="btn btn-secondary" id="overlayMenu">
                    <i class="fas fa-home"></i> Main Menu
                </button>
            </div>
        </div>
    </div>

    <script>
        // Game State
        const gameState = {
            board: Array(9).fill(''),
            currentPlayer: 'X',
            gameActive: true,
            gameMode: 'pvp',
            aiDifficulty: 3,
            scores: { X: 0, O: 0, draws: 0, total: 0 },
            moveHistory: [],
            gameHistory: [],
            timeStarted: null,
            soundEnabled: true,
            animationsEnabled: true,
            theme: 'dark'
        };

        // DOM Elements
        const mainMenu = document.getElementById('mainMenu');
        const gameSection = document.getElementById('gameSection');
        const settingsPanel = document.getElementById('settingsPanel');
        const statsPanel = document.getElementById('statsPanel');
        const gameBoard = document.getElementById('gameBoard');
        const turnIndicator = document.getElementById('turnIndicator');
        const playerXName = document.getElementById('playerXName');
        const playerOName = document.getElementById('playerOName');
        const playerXScore = document.getElementById('playerXScore');
        const playerOScore = document.getElementById('playerOScore');
        const aiDifficulty = document.getElementById('aiDifficulty');
        const aiLevelValue = document.getElementById('aiLevelValue');
        const totalGames = document.getElementById('totalGames');
        const xWins = document.getElementById('xWins');
        const oWins = document.getElementById('oWins');
        const draws = document.getElementById('draws');
        const historyList = document.getElementById('historyList');
        const gameOverlay = document.getElementById('gameOverlay');
        const overlayTitle = document.getElementById('overlayTitle');
        const overlayMessage = document.getElementById('overlayMessage');
        const themeToggle = document.getElementById('themeToggle');

        // Initialize Game
        function init() {
            createBoard();
            setupEventListeners();
            loadFromLocalStorage();
            updateUI();
            showMainMenu();
            
            // Set initial theme
            updateTheme();
        }

        // Create Game Board
        function createBoard() {
            gameBoard.innerHTML = '';
            for (let i = 0; i < 9; i++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.dataset.index = i;
                
                // Add hover effect
                cell.addEventListener('mouseenter', () => {
                    if (!gameState.board[i] && gameState.gameActive) {
                        cell.style.color = gameState.currentPlayer === 'X' ? 
                            'rgba(67, 97, 238, 0.3)' : 'rgba(247, 37, 133, 0.3)';
                        cell.textContent = gameState.currentPlayer;
                    }
                });
                
                cell.addEventListener('mouseleave', () => {
                    if (!gameState.board[i]) {
                        cell.textContent = '';
                    }
                });
                
                cell.addEventListener('click', () => handleCellClick(i));
                gameBoard.appendChild(cell);
            }
        }

        // Setup Event Listeners
        function setupEventListeners() {
            // Menu buttons
            document.getElementById('playVsPlayer').addEventListener('click', () => {
                gameState.gameMode = 'pvp';
                playerXName.textContent = 'Player X';
                playerOName.textContent = 'Player O';
                startGame();
            });
            
            document.getElementById('playVsAI').addEventListener('click', () => {
                gameState.gameMode = 'pvc';
                playerXName.textContent = 'You (X)';
                playerOName.textContent = 'AI (O)';
                startGame();
            });
            
            document.getElementById('openSettings').addEventListener('click', showSettings);
            document.getElementById('openStats').addEventListener('click', showStats);
            document.getElementById('howToPlay').addEventListener('click', showHowToPlay);
            
            // Game controls
            document.getElementById('resetGame').addEventListener('click', resetGame);
            document.getElementById('undoMove').addEventListener('click', undoMove);
            document.getElementById('getHint').addEventListener('click', showHint);
            document.getElementById('backToMenu').addEventListener('click', showMainMenu);
            
            // Settings
            document.getElementById('saveSettings').addEventListener('click', saveSettings);
            document.getElementById('cancelSettings').addEventListener('click', showMainMenu);
            
            // Stats
            document.getElementById('clearStats').addEventListener('click', clearStats);
            document.getElementById('backFromStats').addEventListener('click', showMainMenu);
            
            // Overlay
            document.getElementById('playAgain').addEventListener('click', () => {
                gameOverlay.style.display = 'none';
                resetGame();
            });
            
            document.getElementById('overlayMenu').addEventListener('click', () => {
                gameOverlay.style.display = 'none';
                showMainMenu();
            });
            
            // Theme toggle
            themeToggle.addEventListener('click', toggleTheme);
            
            // Settings options
            document.querySelectorAll('.option-btn[data-mode]').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.option-btn[data-mode]').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            
            // AI Difficulty slider
            aiDifficulty.addEventListener('input', updateAIDifficulty);
            
            // Theme buttons
            document.getElementById('themeDark').addEventListener('click', () => setTheme('dark'));
            document.getElementById('themeLight').addEventListener('click', () => setTheme('light'));
            
            // Sound buttons
            document.getElementById('soundOn').addEventListener('click', () => {
                gameState.soundEnabled = true;
                updateOptionButtons('sound');
            });
            document.getElementById('soundOff').addEventListener('click', () => {
                gameState.soundEnabled = false;
                updateOptionButtons('sound');
            });
            
            // Animation buttons
            document.getElementById('animationsOn').addEventListener('click', () => {
                gameState.animationsEnabled = true;
                updateOptionButtons('animations');
            });
            document.getElementById('animationsOff').addEventListener('click', () => {
                gameState.animationsEnabled = false;
                updateOptionButtons('animations');
            });
        }

        // Show Main Menu
        function showMainMenu() {
            hideAllSections();
            mainMenu.style.display = 'block';
        }

        // Start Game
        function startGame() {
            hideAllSections();
            gameSection.style.display = 'block';
            resetGame();
        }

        // Show Settings
        function showSettings() {
            hideAllSections();
            settingsPanel.style.display = 'block';
            
            // Update settings UI
            document.querySelector(`.option-btn[data-mode="${gameState.gameMode}"]`).classList.add('active');
            aiDifficulty.value = gameState.aiDifficulty;
            updateAIDifficulty();
            updateOptionButtons('sound');
            updateOptionButtons('animations');
        }

        // Show Stats
        function showStats() {
            hideAllSections();
            statsPanel.style.display = 'block';
            updateStatsUI();
        }

        // Hide all sections
        function hideAllSections() {
            mainMenu.style.display = 'none';
            gameSection.style.display = 'none';
            settingsPanel.style.display = 'none';
            statsPanel.style.display = 'none';
        }

        // Handle Cell Click
        function handleCellClick(index) {
            if (!gameState.gameActive || gameState.board[index] !== '') return;

            makeMove(index, gameState.currentPlayer);
            
            if (checkWinner()) return;
            if (checkDraw()) return;

            if (gameState.gameMode === 'pvc' && gameState.currentPlayer === 'O') {
                setTimeout(makeAIMove, 500);
            }
        }

        // Make a Move
        function makeMove(index, player) {
            // Save to history
            gameState.moveHistory.push({
                board: [...gameState.board],
                player: gameState.currentPlayer,
                position: index
            });

            // Update board
            gameState.board[index] = player;
            const cell = document.querySelector(`.cell[data-index="${index}"]`);
            cell.textContent = player;
            cell.classList.add('occupied', player.toLowerCase());

            // Animation
            if (gameState.animationsEnabled) {
                cell.style.transform = 'scale(0)';
                setTimeout(() => {
                    cell.style.transform = 'scale(1)';
                }, 50);
            }

            // Switch player
            gameState.currentPlayer = player === 'X' ? 'O' : 'X';
            updateUI();
        }

        // Check for Winner
        function checkWinner() {
            const winPatterns = [
                [0, 1, 2], [3, 4, 5], [6, 7, 8],
                [0, 3, 6], [1, 4, 7], [2, 5, 8],
                [0, 4, 8], [2, 4, 6]
            ];

            for (const pattern of winPatterns) {
                const [a, b, c] = pattern;
                if (gameState.board[a] && 
                    gameState.board[a] === gameState.board[b] && 
                    gameState.board[a] === gameState.board[c]) {
                    
                    // Highlight winning cells
                    pattern.forEach(index => {
                        const cell = document.querySelector(`.cell[data-index="${index}"]`);
                        cell.classList.add('win');
                    });

                    // Update scores
                    const winner = gameState.board[a];
                    gameState.scores[winner]++;
                    gameState.scores.total++;

                    // Add to history
                    addToHistory(winner);

                    // Show game over
                    showGameOver(winner);
                    return true;
                }
            }
            return false;
        }

        // Check for Draw
        function checkDraw() {
            if (!gameState.board.includes('')) {
                gameState.scores.draws++;
                gameState.scores.total++;
                addToHistory('draw');
                showGameOver('draw');
                return true;
            }
            return false;
        }

        // AI Move
        function makeAIMove() {
            if (!gameState.gameActive) return;

            let moveIndex;
            
            switch(gameState.aiDifficulty) {
                case 1: // Easy - Random
                    moveIndex = getRandomMove();
                    break;
                case 2: // Medium
                    moveIndex = getMediumMove();
                    break;
                case 3: // Hard
                    moveIndex = getHardMove();
                    break;
                case 4: // Expert
                    moveIndex = getExpertMove(4);
                    break;
                case 5: // Master
                    moveIndex = getBestMove();
                    break;
            }

            if (moveIndex !== -1) {
                makeMove(moveIndex, 'O');
            }
        }

        // AI Algorithms
        function getRandomMove() {
            const emptyIndices = gameState.board
                .map((val, idx) => val === '' ? idx : null)
                .filter(val => val !== null);
            
            return emptyIndices.length > 0 ? 
                emptyIndices[Math.floor(Math.random() * emptyIndices.length)] : -1;
        }

        function getMediumMove() {
            let move = findWinningMove('O');
            if (move !== -1) return move;
            
            move = findWinningMove('X');
            if (move !== -1) return move;
            
            if (gameState.board[4] === '') return 4;
            
            const corners = [0, 2, 6, 8];
            const availableCorners = corners.filter(index => gameState.board[index] === '');
            if (availableCorners.length > 0) {
                return availableCorners[Math.floor(Math.random() * availableCorners.length)];
            }
            
            return getRandomMove();
        }

        function getHardMove() {
            return minimax(gameState.board, 3, -Infinity, Infinity, true).index;
        }

        function getExpertMove(depth) {
            return minimax(gameState.board, depth, -Infinity, Infinity, true).index;
        }

        function getBestMove() {
            return minimax(gameState.board, 9, -Infinity, Infinity, true).index;
        }

        function findWinningMove(player) {
            const winPatterns = [
                [0, 1, 2], [3, 4, 5], [6, 7, 8],
                [0, 3, 6], [1, 4, 7], [2, 5, 8],
                [0, 4, 8], [2, 4, 6]
            ];
            
            for (const pattern of winPatterns) {
                const [a, b, c] = pattern;
                const values = [gameState.board[a], gameState.board[b], gameState.board[c]];
                
                const playerCount = values.filter(val => val === player).length;
                const emptyCount = values.filter(val => val === '').length;
                
                if (playerCount === 2 && emptyCount === 1) {
                    if (gameState.board[a] === '') return a;
                    if (gameState.board[b] === '') return b;
                    if (gameState.board[c] === '') return c;
                }
            }
            return -1;
        }

        // Minimax Algorithm
        function minimax(board, depth, alpha, beta, isMaximizing) {
            if (checkWin(board, 'O')) return { score: 10 - depth };
            if (checkWin(board, 'X')) return { score: -10 + depth };
            if (isBoardFull(board) || depth === 0) return { score: 0 };

            const emptyIndices = board
                .map((val, idx) => val === '' ? idx : null)
                .filter(val => val !== null);

            if (isMaximizing) {
                let bestScore = -Infinity;
                let bestMove = -1;

                for (const index of emptyIndices) {
                    board[index] = 'O';
                    const result = minimax(board, depth - 1, alpha, beta, false);
                    board[index] = '';

                    if (result.score > bestScore) {
                        bestScore = result.score;
                        bestMove = index;
                    }
                    
                    alpha = Math.max(alpha, bestScore);
                    if (beta <= alpha) break;
                }
                return { score: bestScore, index: bestMove };
            } else {
                let bestScore = Infinity;
                let bestMove = -1;

                for (const index of emptyIndices) {
                    board[index] = 'X';
                    const result = minimax(board, depth - 1, alpha, beta, true);
                    board[index] = '';

                    if (result.score < bestScore) {
                        bestScore = result.score;
                        bestMove = index;
                    }
                    
                    beta = Math.min(beta, bestScore);
                    if (beta <= alpha) break;
                }
                return { score: bestScore, index: bestMove };
            }
        }

        function checkWin(board, player) {
            const winPatterns = [
                [0, 1, 2], [3, 4, 5], [6, 7, 8],
                [0, 3, 6], [1, 4, 7], [2, 5, 8],
                [0, 4, 8], [2, 4, 6]
            ];
            
            return winPatterns.some(pattern => {
                const [a, b, c] = pattern;
                return board[a] === player && board[b] === player && board[c] === player;
            });
        }

        function isBoardFull(board) {
            return !board.includes('');
        }

        // Show Hint
        function showHint() {
            if (!gameState.gameActive || gameState.gameMode !== 'pvc') return;
            
            const player = gameState.currentPlayer;
            const tempBoard = [...gameState.board];
            let bestMove = -1;
            let bestScore = player === 'X' ? Infinity : -Infinity;

            const emptyIndices = tempBoard
                .map((val, idx) => val === '' ? idx : null)
                .filter(val => val !== null);

            for (const index of emptyIndices) {
                tempBoard[index] = player;
                const score = evaluateBoard(tempBoard, player);
                tempBoard[index] = '';

                if ((player === 'X' && score < bestScore) || 
                    (player === 'O' && score > bestScore)) {
                    bestScore = score;
                    bestMove = index;
                }
            }

            if (bestMove !== -1) {
                const cell = document.querySelector(`.cell[data-index="${bestMove}"]`);
                cell.style.boxShadow = '0 0 30px gold';
                setTimeout(() => {
                    cell.style.boxShadow = '';
                }, 2000);
            }
        }

        function evaluateBoard(board, player) {
            if (checkWin(board, 'O')) return 10;
            if (checkWin(board, 'X')) return -10;
            return 0;
        }

        // Undo Move
        function undoMove() {
            if (gameState.moveHistory.length === 0) return;

            const lastMove = gameState.moveHistory.pop();
            gameState.board = lastMove.board;
            gameState.currentPlayer = lastMove.player;
            gameState.gameActive = true;
            
            updateBoardUI();
            updateUI();
        }

        // Reset Game
        function resetGame() {
            gameState.board = Array(9).fill('');
            gameState.currentPlayer = 'X';
            gameState.gameActive = true;
            gameState.moveHistory = [];
            gameState.timeStarted = new Date();
            
            updateBoardUI();
            updateUI();
        }

        // Update UI
        function updateUI() {
            // Update turn indicator
            if (!gameState.gameActive) {
                turnIndicator.textContent = 'Game Over';
            } else {
                turnIndicator.textContent = gameState.currentPlayer === 'X' ? 
                    'Player X\'s Turn' : 
                    gameState.gameMode === 'pvc' ? 'AI Thinking...' : 'Player O\'s Turn';
            }
            
            // Update scores
            playerXScore.textContent = `Wins: ${gameState.scores.X}`;
            playerOScore.textContent = `Wins: ${gameState.scores.O}`;
        }

        function updateBoardUI() {
            const cells = document.querySelectorAll('.cell');
            cells.forEach((cell, index) => {
                cell.textContent = gameState.board[index];
                cell.className = 'cell';
                if (gameState.board[index]) {
                    cell.classList.add('occupied', gameState.board[index].toLowerCase());
                }
            });
        }

        // Update AI Difficulty
        function updateAIDifficulty() {
            gameState.aiDifficulty = parseInt(aiDifficulty.value);
            const levels = ['Easy', 'Medium', 'Hard', 'Expert', 'Master'];
            aiLevelValue.textContent = levels[gameState.aiDifficulty - 1];
        }

        // Update Option Buttons
        function updateOptionButtons(type) {
            if (type === 'sound') {
                document.getElementById('soundOn').classList.toggle('active', gameState.soundEnabled);
                document.getElementById('soundOff').classList.toggle('active', !gameState.soundEnabled);
            } else if (type === 'animations') {
                document.getElementById('animationsOn').classList.toggle('active', gameState.animationsEnabled);
                document.getElementById('animationsOff').classList.toggle('active', !gameState.animationsEnabled);
            }
        }

        // Show Game Over
        function showGameOver(result) {
            gameState.gameActive = false;
            
            let title, message;
            if (result === 'X') {
                title = ' Player X Wins!';
                message = 'Congratulations on your victory!';
            } else if (result === 'O') {
                title = gameState.gameMode === 'pvc' ? ' AI Wins!' : ' Player O Wins!';
                message = gameState.gameMode === 'pvc' ? 'The AI outsmarted you this time!' : 'Excellent play by Player O!';
            } else {
                title = ' Draw!';
                message = 'The game ended in a tie. Well played!';
            }
            
            overlayTitle.textContent = title;
            overlayMessage.textContent = message;
            gameOverlay.style.display = 'flex';
            
            saveToLocalStorage();
        }

        // Add to History
        function addToHistory(result) {
            const gameTime = Math.floor((new Date() - gameState.timeStarted) / 1000);
            const game = {
                id: Date.now(),
                result: result,
                time: gameTime,
                moves: gameState.moveHistory.length,
                date: new Date().toLocaleDateString()
            };
            
            gameState.gameHistory.unshift(game);
            if (gameState.gameHistory.length > 10) {
                gameState.gameHistory.pop();
            }
        }

        // Update Stats UI
        function updateStatsUI() {
            totalGames.textContent = gameState.scores.total;
            xWins.textContent = gameState.scores.X;
            oWins.textContent = gameState.scores.O;
            draws.textContent = gameState.scores.draws;
            
            historyList.innerHTML = '';
            gameState.gameHistory.forEach(game => {
                const item = document.createElement('div');
                item.className = 'history-item';
                
                const resultClass = game.result === 'draw' ? 'draw' : 
                    (game.result === 'X' ? 'win' : 'loss');
                const resultText = game.result === 'draw' ? 'Draw' : 
                    (game.result === 'X' ? 'X Wins' : 'O Wins');
                
                item.innerHTML = `
                    <div>
                        <div style="font-weight: 600; color: var(--text);">Game ${game.id.toString().slice(-4)}</div>
                        <small style="color: var(--text-secondary);">${game.date}  ${game.moves} moves  ${game.time}s</small>
                    </div>
                    <div style="padding: 5px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; 
                         background: ${resultClass === 'win' ? 'rgba(76, 201, 240, 0.2)' : 
                                    resultClass === 'loss' ? 'rgba(247, 37, 133, 0.2)' : 
                                    'rgba(255, 255, 255, 0.1)'};
                         color: ${resultClass === 'win' ? 'var(--success)' : 
                                resultClass === 'loss' ? 'var(--accent)' : 
                                'var(--text-secondary)'}">
                        ${resultText}
                    </div>
                `;
                
                historyList.appendChild(item);
            });
        }

        // Clear Stats
        function clearStats() {
            if (confirm('Are you sure you want to clear all statistics?')) {
                gameState.scores = { X: 0, O: 0, draws: 0, total: 0 };
                gameState.gameHistory = [];
                updateStatsUI();
                saveToLocalStorage();
            }
        }

        // Show How to Play
        function showHowToPlay() {
            alert(` HOW TO PLAY TIC-TAC-TOE \n\n1. Players take turns placing X and O on the grid\n2. First player to get 3 in a row (horizontally, vertically, or diagonally) wins\n3. If all squares are filled with no winner, it's a draw\n\n CONTROLS \n Click on any empty square to make a move\n Use "Undo" to take back your last move\n Use "Hint" to get a suggested move (vs AI only)\n "New Game" starts a fresh game\n "Menu" returns to the main menu\n\n SETTINGS \n Choose between Player vs Player or Player vs AI\n Adjust AI difficulty from Easy to Master\n Toggle between Dark and Light themes\n Enable/disable sounds and animations`);
        }

        // Theme Functions
        function toggleTheme() {
            gameState.theme = gameState.theme === 'dark' ? 'light' : 'dark';
            updateTheme();
        }

        function setTheme(theme) {
            gameState.theme = theme;
            updateTheme();
        }

        function updateTheme() {
            document.body.className = `${gameState.theme}-theme`;
            themeToggle.innerHTML = gameState.theme === 'dark' ? 
                '<i class="fas fa-moon"></i> Dark Mode' : 
                '<i class="fas fa-sun"></i> Light Mode';
        }

        // Save Settings
        function saveSettings() {
            const selectedMode = document.querySelector('.option-btn[data-mode].active').dataset.mode;
            gameState.gameMode = selectedMode;
            gameState.aiDifficulty = parseInt(aiDifficulty.value);
            
            if (gameState.gameMode === 'pvp') {
                playerXName.textContent = 'Player X';
                playerOName.textContent = 'Player O';
            } else {
                playerXName.textContent = 'You (X)';
                playerOName.textContent = 'AI (O)';
            }
            
            saveToLocalStorage();
            showMainMenu();
        }

        // Local Storage
        function saveToLocalStorage() {
            localStorage.setItem('ticTacToeData', JSON.stringify(gameState));
        }

        function loadFromLocalStorage() {
            try {
                const savedData = JSON.parse(localStorage.getItem('ticTacToeData'));
                if (savedData) {
                    Object.assign(gameState, savedData);
                    updateTheme();
                }
            } catch (e) {
                console.log('No saved data found');
            }
        }

        // Initialize the game
        window.addEventListener('DOMContentLoaded', init);
        
        // Center game board on window resize
        window.addEventListener('resize', () => {
            // Auto-recenter is handled by CSS flexbox
        });
    </script>
</body>
</html>
